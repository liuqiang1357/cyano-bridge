module.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var i={};function r(e){if("Boolean"===e.type||"Integer"===e.type)return{name:e.name,value:e.value};if("String"===e.type||"ByteArray"===e.type||"Long"===e.type||"Address"===e.type)return{name:e.name,value:e.type+":"+e.value};if("Array"===e.type)return{name:e.name,value:e.value.map(e=>r(e))};if("Map"===e.type){const t={};for(const n of Object.keys(e.value))t[n]=r(e.value[n]);return{name:e.name,value:t}}throw new Error("Invalid parmeter type: "+JSON.stringify(e))}function o(e,t){const n=[];for(const e of t)n.push(r(e));return{operation:e,args:n}}function a(){return Math.random().toString(36).substring(2,10)}n.r(i),n.d(i,"registerClient",(function(){return g})),n.d(i,"api",(function(){return p}));var s=class{constructor(e){this.timeout=3e3,this.version="v1.0.0",this.handlers={},e&&(this.timeout=e),this.injected=!1,this.pendingMsgs=[]}call(e){const t=a();return e.id=t,new Promise((n,i)=>{const r="ontprovider://ont.io?params="+btoa(encodeURIComponent(JSON.stringify(e)));this.sendMessage(r),this.handleMessageEvent(t,n,i,e.action,e.needTimeout)})}invokeRead(){throw new Error("invokeRead not supported yet.")}parseMessage(e){return JSON.parse(decodeURIComponent(atob(e)))}onMessage(e){this.listener&&this.offMessage();const t=t=>{const n=this.parseMessage(t.data);e(n)};window.document.addEventListener("message",t),this.listener=t}offMessage(){window.document.removeEventListener("message",this.listener)}sendMessage(e){this.injected?window.postMessage(e,"*"):this.checkInterval?this.pendingMsgs.push(e):this.checkInterval=window.setInterval(()=>{window.originalPostMessage&&(window.postMessage(e,"*"),this.injected=!0,this.pendingMsgs.forEach(e=>{window.postMessage(e,"*")}),window.clearInterval(this.checkInterval))},100)}handleMessageEvent(e,t,n,i,r=!1){const o=this,a=function(e){const r=e.data;r||n(e);const s=o.parseMessage(r);s.id||n("No message id"),o.handlers[s.id]||n("No message handler"),s.id===a.id&&(document.removeEventListener("message",o.handlers[s.id]),delete o.handlers[s.id],s.action===i?t(s):n(s))};a.id=e,this.handlers[e]=a,document.addEventListener("message",this.handlers[e]),r&&setTimeout(()=>{n("Time out")},this.timeout)}};let c;function g(e=3e3){c=new s(e)}async function u(e){return c.call(e)}const d={invoke(e){if(!e.scriptHash||!e.operation||!e.args)throw new Error("Invalid params.");if(!e.payer)throw new Error("No payer.");e.config||(e.config={login:!0,message:"",url:""});const t=o(e.operation,e.args);return u({action:"invoke",version:"1.0.0",params:{login:e.config.login,url:e.config.url,message:e.config.message,invokeConfig:{contractHash:e.scriptHash,functions:[t],payer:e.payer,gasPrice:e.gasPrice?e.gasPrice:500,gasLimit:e.gasLimit?e.gasLimit:2e4}}})},invokeRead(e){if(!e.scriptHash||!e.operation||!e.args)throw new Error("Invalid params.");e.config||(e.config={login:!0,message:"",url:""});const t=o(e.operation,e.args);return u({action:"invokeRead",version:"1.0.0",params:{login:e.config.login,url:e.config.url,message:e.config.message,invokeConfig:{contractHash:e.scriptHash,functions:[t],payer:e.payer,gasPrice:e.gasPrice?e.gasPrice:500,gasLimit:e.gasLimit?e.gasLimit:2e4}}})},invokePasswordFree(e){if(!e.scriptHash||!e.operation||!e.args||0===e.args.length)throw new Error("Invalid params.");if(!e.payer)throw new Error("No payer.");e.config||(e.config={login:!0,message:"",url:""});const t=o(e.operation,e.args);return u({action:"invokePasswordFree",version:"1.0.0",params:{login:e.config.login,url:e.config.url,message:e.config.message,invokeConfig:{contractHash:e.scriptHash,functions:[t],payer:e.payer,gasPrice:e.gasPrice?e.gasPrice:500,gasLimit:e.gasLimit?e.gasLimit:2e4}}})}},p={asset:{getAccount:e=>u({action:"getAccount",version:"1.0.0",params:e,needTimeout:!0}),transfer({from:e,to:t,asset:n,amount:i,gasPrice:r,gasLimit:o}){const a={scriptHash:"ONT"===n?"0100000000000000000000000000000000000000":"0200000000000000000000000000000000000000",operation:"transfer",args:[{name:"from",type:"Address",value:e},{name:"to",type:"Address",value:t},{name:"amount",type:"Long",value:i}],gasPrice:500,gasLimit:2e4,payer:e};return d.invoke(a)}},identity:{getIdentity:e=>u({action:"getIdentity",version:"1.0.0",params:e,needTimeout:!0}),authentication:e=>u({action:"authentication",version:"1.0.0",params:e}),authorization:e=>u({action:"authorization",version:"1.0.0",params:e}),registerOntId({ontid:e,publicKey:t,payer:n,gasPrice:i,gasLimit:r}){const o={scriptHash:"0300000000000000000000000000000000000000",operation:"regIDWithPublicKey",args:[{name:"ontid",type:"String",value:e},{name:"pk",type:"ByteArray",value:t}],gasPrice:500,gasLimit:2e4,payer:n};return d.invoke(o)},getDDO(e){const t={scriptHash:"0300000000000000000000000000000000000000",operation:"getDDO",args:[{name:"ontid",type:"String",value:e}],gasPrice:500,gasLimit:2e4};return d.invokeRead(t)}},message:{signMessage:e=>u({action:"signMessage",version:"1.0.0",params:e,needTimeout:!1}),login(e){if(!e.message||"string"!=typeof e.message)throw new Error("Parameter for login must contain a message.");return e.type||(e.type="account"),u({action:"login",version:"1.0.0",params:e,needTimeout:!1})}},mobile:{getData:e=>u({action:"getData",version:"1.0.0",params:e,needTimeout:!1}),doAction:e=>u({action:"doAction",version:"1.0.0",params:e,needTimeout:!1}),gotoWebview:e=>u({action:"gotoWebview",version:"1.0.0",params:e,needTimeout:!1}),gotoNative:e=>u({action:"gotoNative",version:"1.0.0",params:e,needTimeout:!1}),switchIdentity:()=>u({action:"switch_ontid",version:"1.0.0",needTimeout:!1}),switchDeviceCode:()=>u({action:"switch_device_code",version:"1.0.0",needTimeout:!1})},smartContract:d,qrcode:{login(e){if("ontid"!==e.type&&"account"!==e.type)throw new Error("Invalid parameter type "+e.type);const t={action:"login",version:"1.0.0",id:a(),params:e};return JSON.stringify(t)},invoke(e){const t={action:"invoke",version:"1.0.0",id:a(),params:e};return JSON.stringify(t)}},provider:{getProvider:()=>u({action:"getProvider",version:"1.0.0",needTimeout:!0})},stateChannel:{login:()=>u({action:"stateChannelLogin",version:"1.0.0",params:{},needTimeout:!1})}};n.d(t,"client",(function(){return i}))}]);
//# sourceMappingURL=index.js.map